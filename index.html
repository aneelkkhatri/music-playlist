<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>YouTube Playlist Viewer</title>
  <style>
    body {
      font-family: 'Segoe UI', 'Roboto', Arial, sans-serif;
      margin: 0;
      background: #181a20;
      color: #f3f3f3;
      min-height: 100vh;
    }
    h1 {
      text-align: center;
      font-size: 2.5em;
      margin: 1.5em 0 1em 0;
      color: #00bfae;
      letter-spacing: 2px;
      font-weight: 700;
      text-shadow: 0 2px 8px #0008;
    }
    #playlist {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 2em;
      padding-bottom: 2em;
    }
    .video {
      background: #23263a;
      border-radius: 18px;
      box-shadow: 0 4px 24px #0006, 0 1.5px 6px #00bfae44;
      display: flex;
      flex-direction: column;
      gap: 0;
      padding: 1.2em 2em;
      width: 100%;
      max-width: 600px;
      position: relative;
      overflow: hidden;
    }
    .thumb-square {
      width: 120px;
      height: 120px;
      object-fit: cover;
      object-position: center;
      border-radius: 14px;
      box-shadow: 0 2px 12px #00bfae44, 0 1px 4px #0006;
      background: #222;
      flex-shrink: 0;
      margin-right: 1em;
      display: block;
      cursor: pointer;
    }
    .video-info {
      display: flex;
      flex-direction: column;
      justify-content: center;
      flex: 1;
    }
    .video-title {
      font-size: 1.15em;
      font-weight: 600;
      color: #fff;
      margin-bottom: 0.5em;
      text-shadow: 0 1px 4px #0006;
      line-height: 1.2;
      letter-spacing: 0.5px;
      word-break: break-word;
    }
    .video-channel {
      font-size: 0.95em;
      color: #00bfae;
      font-weight: 500;
      margin-bottom: 0.2em;
      opacity: 0.85;
    }
    .channel-url,.video-url {
      font-size: 0.9em;
      color: #b3b3b3;
      opacity: 0.7;
      margin-top: 0.2em;
      word-break: break-all;
    }
    iframe {
      display: block;
      margin-top: 0.5em;
      border-radius: 14px;
      box-shadow: 0 2px 12px #00bfae44, 0 1px 4px #0006;
      background: #222;
    }
  </style>
</head>
<body>
  <h1>YouTube Playlist</h1>
  <div id="playlist"></div>
  <script>
    let allVideos = [];
    let currentIndex = 0;
  const batchSize = 10;
    const container = document.getElementById('playlist');

    // Get query parameter from URL
    function getQueryParam(name) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(name);
    }
        const showEmbed = getQueryParam('embed') === 'true'; // default is false
        const playlistFile = getQueryParam('file')

    function renderNextBatch() {
      const nextVideos = allVideos.slice(currentIndex, currentIndex + batchSize);
      nextVideos.forEach(video => {
        const div = document.createElement('div');
        div.className = 'video';
        if (showEmbed) {
          div.innerHTML = `
            <div class="video-info">
              <span class="video-title">${video.title}</span>
              <span class="video-channel">${video.channel || ''}</span>
              <a class="video-url" href="https://www.youtube.com/watch?v=${video.id}" target="_blank">Watch on YouTube</a>
            </div>
            <iframe width="160" height="90" src="https://www.youtube.com/embed/${video.id}" frameborder="0" allowfullscreen></iframe>
          `;
        } else {
          // Create a wrapper for image and text
          div.innerHTML = '';
          const row = document.createElement('div');
          row.style.display = 'flex';
          row.style.flexDirection = 'row';
          row.style.alignItems = 'center';
          row.style.gap = '1.5em';
          // Image
          const img = document.createElement('img');
          img.className = 'thumb-non-square';
          img.src = video.thumbnails[0].url;
          img.alt = video.title;
          // Info
          const info = document.createElement('div');
          info.className = 'video-info';
          info.innerHTML = `
            <span class="video-title">${video.title}</span>
            <a class="channel-url" href="https://www.youtube.com/channel/${video.channel_id}" target="_blank"><span class="video-channel">${video.channel || ''}</span></a>
            <a class="video-url" href="https://www.youtube.com/watch?v=${video.id}" target="_blank">Watch on YouTube</a>
          `;
          row.appendChild(img);
          row.appendChild(info);
          div.appendChild(row);
          // Add click event to thumbnail to embed video below row
          img.addEventListener('click', function() {
            const existing = div.querySelector('iframe');
            if (existing) {
              existing.remove();
            } else {
              const iframe = document.createElement('iframe');
              // iframe.width = 160;
              iframe.height = 300;
              iframe.src = `https://www.youtube.com/embed/${video.id}`;
              iframe.frameBorder = '0';
              iframe.allowFullscreen = true;
              iframe.style.display = 'block';
              iframe.style.marginTop = '1em';
              iframe.style.borderRadius = '14px';
              iframe.style.boxShadow = '0 2px 12px #00bfae44, 0 1px 4px #0006';
              div.appendChild(iframe);
            }
          });
        }
        container.appendChild(div);
      });
      currentIndex += batchSize;
    }
    
      function fillViewportIfNeeded() {
        // Load more batches if not enough content to fill viewport
        setTimeout(() => {
          while (currentIndex < allVideos.length && document.body.offsetHeight < window.innerHeight) {
            renderNextBatch();
          }
        }, 0);
      }

    function handleScroll() {
      if ((window.innerHeight + window.scrollY) >= document.body.offsetHeight - 100) {
        if (currentIndex < allVideos.length) {
          renderNextBatch();
        }
      }
    }

  fetch(playlistFile)
      .then(response => response.json())
      .then(data => {
        allVideos = data.entries;
        renderNextBatch();
          fillViewportIfNeeded();
        window.addEventListener('scroll', handleScroll);
      });
  </script>
</body>
</html>
